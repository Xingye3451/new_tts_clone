syntax = "proto3";

package voice_service;

// ä»»åŠ¡çŠ¶æ€æšä¸¾
enum TaskStatus {
  UNKNOWN = 0;       // æœªçŸ¥çŠ¶æ€
  CREATED = 1;       // ä»»åŠ¡å·²åˆ›å»º
  INITIALIZED = 2;   // ä»»åŠ¡å·²åˆå§‹åŒ–
  PENDING = 3;       // ç­‰å¾…å¤„ç†
  PROCESSING = 4;    // å¤„ç†ä¸­
  COMPLETED = 5;     // å¤„ç†å®Œæˆ
  FAILED = 6;        // å¤„ç†å¤±è´¥
}

// å£°éŸ³åˆæˆæœåŠ¡
service VoiceService {
  // éŸ³è‰²å…‹éš†ï¼šä½¿ç”¨æºéŸ³é¢‘çš„å£°éŸ³ç‰¹å¾æ¥åˆæˆç›®æ ‡æ–‡æœ¬çš„éŸ³é¢‘ - åŒæ­¥å¤„ç†
  rpc CloneVoice(CloneVoiceRequest) returns (CloneVoiceResponse) {}
  
  // æŒ‡å®šéŸ³è‰²åˆæˆï¼šä½¿ç”¨é¢„è®¾æˆ–å·²ä¿å­˜çš„å£°éŸ³æ¥åˆæˆæ–‡æœ¬ - åŒæ­¥å¤„ç†
  rpc Synthesize(SynthesizeRequest) returns (SynthesizeResponse) {}
  
  // ä»è§†é¢‘ä¸­æå–éŸ³é¢‘ - åŒæ­¥å¤„ç†
  rpc ExtractAudioFromVideo(ExtractAudioRequest) returns (ExtractAudioResponse) {}
  
  // ä¸ºè§†é¢‘æ·»åŠ å­—å¹• - åŒæ­¥å¤„ç†
  rpc AddSubtitleToVideo(AddSubtitleRequest) returns (AddSubtitleResponse) {}
}

// éŸ³è‰²å…‹éš†è¯·æ±‚
message CloneVoiceRequest {
  string audio_name = 1;    // æºéŸ³é¢‘æ–‡ä»¶å
  string target_text = 2;   // ç›®æ ‡æ–‡æœ¬
  float voice_speed = 3;    // è¯­éŸ³é€Ÿåº¦ï¼Œé»˜è®¤ä¸º1.0
  string task_id = 4;       // ä»»åŠ¡IDï¼ˆå¯é€‰ï¼‰
  string task_step = 5;     // ä»»åŠ¡æ­¥éª¤ï¼ˆå¯é€‰ï¼‰
  string prompt_text = 6;   // æç¤ºæ–‡æœ¬
}

// éŸ³è‰²å…‹éš†å“åº”
message CloneVoiceResponse {
  string task_id = 1;           // ä»»åŠ¡ID
  TaskStatus status = 2;        // ä»»åŠ¡çŠ¶æ€
  string message = 3;           // çŠ¶æ€æ¶ˆæ¯
  bool is_finished = 4;         // æ˜¯å¦å®Œæˆ
  string output_filename = 5;   // è¾“å‡ºæ–‡ä»¶åç§°ï¼ˆå”¯ä¸€ï¼‰
  repeated TranscriptionSegment segments = 6;  // è¯†åˆ«ç»“æœ
}

// æŒ‡å®šéŸ³è‰²åˆæˆè¯·æ±‚
message SynthesizeRequest {
  string text = 1;           // è¦åˆæˆçš„æ–‡æœ¬
  string voice_name = 2;     // å£°éŸ³åç§°ï¼ˆå¯é€‰ï¼‰
  float voice_speed = 3;     // è¯­éŸ³é€Ÿåº¦ï¼ˆå¯é€‰ï¼‰
  string task_id = 4;        // ä»»åŠ¡IDï¼ˆå¯é€‰ï¼‰
  string task_step = 5;      // ä»»åŠ¡æ­¥éª¤ï¼ˆå¯é€‰ï¼‰
  string whisper_model = 6;  // è¯­éŸ³è¯†åˆ«æ¨¡å‹ï¼ˆå¯é€‰,é»˜è®¤æ˜¯smallï¼Œå¯é€‰ï¼štiny, base, small, medium, large-v2ï¼‰
  string whisper_language = 7; // è¯­éŸ³è¯†åˆ«è¯­è¨€ï¼ˆå¯é€‰ï¼Œé»˜è®¤æ˜¯zhï¼‰
  string compute_type = 8;   // ç²¾åº¦ï¼ˆå¯é€‰ï¼Œé»˜è®¤int8ï¼‰
  string prompt_text = 9;    // æç¤ºæ–‡æœ¬
}

// æŒ‡å®šéŸ³è‰²åˆæˆå“åº”
message SynthesizeResponse {
  string task_id = 1;           // ä»»åŠ¡ID
  TaskStatus status = 2;        // ä»»åŠ¡çŠ¶æ€
  string message = 3;           // çŠ¶æ€æ¶ˆæ¯
  bool is_finished = 4;         // æ˜¯å¦å®Œæˆ
  string output_filename = 5;   // è¾“å‡ºæ–‡ä»¶åç§°ï¼ˆå”¯ä¸€ï¼‰
}

// ä»è§†é¢‘æå–éŸ³é¢‘è¯·æ±‚
message ExtractAudioRequest {
  string video_name = 1;    // æºè§†é¢‘æ–‡ä»¶è·¯å¾„
  int32 sample_rate = 2;    // é‡‡æ ·ç‡ï¼ˆå¯é€‰ï¼Œé»˜è®¤44100ï¼‰
  bool mono = 3;            // æ˜¯å¦å•å£°é“ï¼ˆå¯é€‰ï¼Œé»˜è®¤trueï¼‰
  float start_time = 4;     // å¼€å§‹æ—¶é—´ï¼ˆç§’ï¼‰ï¼Œé»˜è®¤ä¸º0
  float duration = 5;       // æŒç»­æ—¶é—´ï¼ˆç§’ï¼‰ï¼Œé»˜è®¤ä¸º10ç§’ï¼Œè®¾ä¸º0è¡¨ç¤ºæå–åˆ°ç»“å°¾
  bool auto_detect_voice = 6; // æ˜¯å¦è‡ªåŠ¨æ£€æµ‹æœ‰å£°éƒ¨åˆ†ï¼ˆå¯é€‰ï¼Œé»˜è®¤falseï¼‰
  float max_silence = 7;    // æœ€å¤§é™éŸ³æ—¶é•¿ï¼ˆç§’ï¼‰ï¼Œç”¨äºè‡ªåŠ¨æ£€æµ‹ï¼ˆå¯é€‰ï¼Œé»˜è®¤2.0ï¼‰
  string task_id = 8;       // ä»»åŠ¡IDï¼ˆå¯é€‰ï¼‰
  string task_step = 9;     // ä»»åŠ¡æ­¥éª¤ï¼ˆå¯é€‰ï¼‰
}

// ä»è§†é¢‘æå–éŸ³é¢‘å“åº”
message ExtractAudioResponse {
  string task_id = 1;           // ä»»åŠ¡ID
  TaskStatus status = 2;        // ä»»åŠ¡çŠ¶æ€
  string message = 3;           // çŠ¶æ€æ¶ˆæ¯
  bool is_finished = 4;         // æ˜¯å¦å®Œæˆ
  string output_filename = 5;   // è¾“å‡ºæ–‡ä»¶åç§°ï¼ˆå”¯ä¸€ï¼‰
  string prompt_text = 6;       // ç”Ÿæˆæç¤ºæ–‡æœ¬
}

// ä¸ºè§†é¢‘æ·»åŠ å­—å¹•è¯·æ±‚
message AddSubtitleRequest {
  string video_name = 1;      // æºè§†é¢‘æ–‡ä»¶å
  string subtitle_text = 2;   // å­—å¹•æ–‡æœ¬å†…å®¹ï¼ˆçº¯æ–‡æœ¬ï¼Œå°†è‡ªåŠ¨ä¸è¯­éŸ³å¯¹é½ï¼‰
  string task_id = 3;         // ä»»åŠ¡IDï¼ˆå¯é€‰ï¼‰
  string task_step = 4;       // ä»»åŠ¡æ­¥éª¤ï¼ˆå¯é€‰ï¼‰
  
  // å­—ä½“æ ·å¼å‚æ•°
  string font_name = 5;       // å­—ä½“åç§°ï¼ˆå¯é€‰ï¼Œé»˜è®¤Arialï¼‰
                              // ğŸ¯ å®¹å™¨ä¸­å¯ç”¨çš„å­—ä½“é€‰é¡¹ï¼š
                              // 
                              // ã€è‹±æ–‡å­—ä½“ã€‘ï¼ˆæ¨èç”¨äºå‰ç«¯ä¸‹æ‹‰é€‰æ‹©ï¼‰
                              // - "Arial" (ç³»ç»Ÿé»˜è®¤ï¼Œå…¼å®¹æ€§æœ€ä½³)
                              // - "DejaVu Sans" (æ— è¡¬çº¿ï¼Œæ¸…æ™°æ˜“è¯»)
                              // - "DejaVu Serif" (è¡¬çº¿å­—ä½“ï¼Œæ­£å¼æ–‡æ¡£é£æ ¼)
                              // - "DejaVu Sans Mono" (ç­‰å®½å­—ä½“ï¼Œä»£ç é£æ ¼)
                              // - "Liberation Sans" (ç±»ä¼¼Arialçš„å¼€æºå­—ä½“)
                              // - "Liberation Serif" (ç±»ä¼¼Timesçš„å¼€æºå­—ä½“)
                              // - "Liberation Mono" (ç­‰å®½å­—ä½“)
                              // 
                              // ã€ä¸­æ–‡å­—ä½“ã€‘ï¼ˆæ”¯æŒä¸­æ–‡æ˜¾ç¤ºï¼‰
                              // - "Noto Sans CJK SC" (Google Notoç®€ä½“ä¸­æ–‡ï¼Œæ¨è)
                              // - "Noto Serif CJK SC" (Google Notoç®€ä½“ä¸­æ–‡è¡¬çº¿)
                              // - "WenQuanYi Zen Hei" (æ–‡æ³‰é©¿æ­£é»‘ï¼Œå¼€æºä¸­æ–‡å­—ä½“)
                              // - "WenQuanYi Micro Hei" (æ–‡æ³‰é©¿å¾®ç±³é»‘ï¼Œç´§å‡‘å‹ä¸­æ–‡å­—ä½“)
                              // 
                              // ã€å­—ä½“æ–‡ä»¶è·¯å¾„ã€‘ï¼ˆé«˜çº§ç”¨æˆ·ï¼‰
                              // - "/usr/share/fonts/truetype/dejavu/DejaVuSans.ttf"
                              // - "/usr/share/fonts/opentype/noto/NotoSansCJK-Regular.ttc"
                              // - "/usr/share/fonts/truetype/wqy/wqy-zenhei.ttc"
                              // 
                              // ğŸ’¡ å‰ç«¯å»ºè®®ï¼š
                              // 1. æä¾›ä¸‹æ‹‰é€‰æ‹©ï¼Œé»˜è®¤"Arial"
                              // 2. ä¸­è‹±æ–‡æ··åˆå†…å®¹æ¨è"Noto Sans CJK SC"
                              // 3. çº¯è‹±æ–‡å†…å®¹æ¨è"DejaVu Sans"
                              // 4. æ­£å¼æ–‡æ¡£é£æ ¼æ¨è"Liberation Serif"
  
  int32 font_size = 6;        // å­—ä½“å¤§å°ï¼ˆå¯é€‰ï¼Œé»˜è®¤24ï¼‰
                              // èŒƒå›´: 8-128ï¼Œæ¨è 18-48
  
  string font_color = 7;      // å­—ä½“é¢œè‰²ï¼ˆå¯é€‰ï¼Œé»˜è®¤whiteï¼‰
                              // æ”¯æŒæ ¼å¼:
                              // - è‹±æ–‡é¢œè‰²å: white, black, red, green, blue, yellow, cyan, magenta
                              // - åå…­è¿›åˆ¶: #FFFFFF, #FF0000, #00FF00, #0000FF
                              // - RGBå€¼: 0xFFFFFF, 0xFF0000
                              // - é€æ˜åº¦: white@0.8, #FF0000@0.5 (é€æ˜åº¦0.0-1.0)
                              // æ³¨æ„: è¯·å‹¿ä½¿ç”¨ä¸­æ–‡é¢œè‰²åï¼ŒFFmpegä¸è¯†åˆ«
  
  string background_color = 8; // å­—å¹•èƒŒæ™¯é¢œè‰²ï¼ˆå¯é€‰ï¼Œé»˜è®¤transparentï¼‰
                               // æ”¯æŒæ ¼å¼å®Œå…¨ç›¸åŒäºfont_color:
                               // - è‹±æ–‡é¢œè‰²å: white, black, red, green, blue, yellow, cyan, magenta
                               // - åå…­è¿›åˆ¶: #FFFFFF, #FF0000, #00FF00, #0000FF
                               // - RGBå€¼: 0xFFFFFF, 0xFF0000  
                               // - é€æ˜åº¦: black@0.5, #000000@0.3 (æ¨è0.3-0.7)
                               // - ç‰¹æ®Šå€¼: transparent (é€æ˜), none (æ— èƒŒæ™¯)
  
  bool add_border = 9;        // æ˜¯å¦æ·»åŠ è¾¹æ¡†ï¼ˆå¯é€‰ï¼Œé»˜è®¤trueï¼‰
                              // true: æ·»åŠ é»‘è‰²è¾¹æ¡†ï¼Œæé«˜å¯è¯»æ€§
                              // false: æ— è¾¹æ¡†
  
  string position = 10;       // å­—å¹•ä½ç½®ï¼ˆå¯é€‰ï¼Œé»˜è®¤bottomï¼‰
                              // æ”¯æŒå€¼:
                              // - bottom: åº•éƒ¨å±…ä¸­
                              // - top: é¡¶éƒ¨å±…ä¸­  
                              // - middle: ä¸­å¤®
                              // - left: å·¦ä¾§
                              // - right: å³ä¾§
}

// ä¸ºè§†é¢‘æ·»åŠ å­—å¹•å“åº”
message AddSubtitleResponse {
  string task_id = 1;           // ä»»åŠ¡ID
  TaskStatus status = 2;        // ä»»åŠ¡çŠ¶æ€
  string message = 3;           // çŠ¶æ€æ¶ˆæ¯
  bool is_finished = 4;         // æ˜¯å¦å®Œæˆ
  string output_filename = 5;   // è¾“å‡ºæ–‡ä»¶åç§°ï¼ˆå”¯ä¸€ï¼‰
}

// è¯­éŸ³è¯†åˆ«ç»“æœç‰‡æ®µ
message TranscriptionSegment {
  string text = 1;           // è¯†åˆ«çš„æ–‡æœ¬
  float start = 2;          // å¼€å§‹æ—¶é—´ï¼ˆç§’ï¼‰
  float end = 3;            // ç»“æŸæ—¶é—´ï¼ˆç§’ï¼‰
} 